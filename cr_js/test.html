<html>
<head>
<link rel="stylesheet" href="scripts/lib/jquery-ui/jquery-ui.min.css">
<script data-main="scripts/vispy" src="scripts/lib/require.js"></script>
<script>
require(["vispy"], function(vispy) {
    c = vispy.init("#mycanvas");

    // Shaders.
    var VS = " \
    attribute vec2 a_position; \
    void main() { \
        gl_Position = vec4(a_position, 0, 1); \
    }";

    var FS = " \
    uniform vec3 u_color; \
    void main() { \
        gl_FragColor = vec4(u_color, 1); \
    }";

    // Initialize the scene.
    c.on_initialize(function (event) {
        this.call(['CREATE', 'myvbo', 'VertexBuffer']);
        this.call(['DATA', 'myvbo', 0, new Float32Array([-0.5, -0.5, 0.5, -0.5, 0.5, 0.5])]);

        this.call(['CREATE', 'myprogram', 'Program']);
        this.call(['SHADERS', 'myprogram', VS, FS]);
        this.call(['ATTRIBUTE', 'myprogram', 'a_position',
                                 'vec2', 'myvbo', 0, 0]);
        this.call(['UNIFORM', 'myprogram', 'u_color', 'vec3', new Float32Array([1., 1., 1.])]);
    });

    // Update the viewport upon resize.
    c.on_resize(function(event) {
        this.call(['FUNC', 'viewport', 0, 0, event.size[0], event.size[1]]);
        this.update();
    });

    // Draw the scene.
    c.on_paint(function(event) {
        this.call(['FUNC', 'clearColor', 0, 0, 0, 1]);
        this.call(['FUNC', 'clear', 'COLOR_BUFFER_BIT']);
        this.call(['DRAW', 'myprogram', 'TRIANGLE_STRIP',
                                 [0, 3]]);
    });

    // Interactivity on mouse movements.
    c.on_mouse_move(function(event) {
        // Get the normalized mouse position.
        var u = event.pos[0] / this.width;
        var v = event.pos[1] / this.height;
        
        // Update a data point when dragging.
        if (event.is_dragging) {
            this.call(['DATA', 'myvbo', 2*4,  // 2 float32 elements
                new Float32Array([2*u-1, 1-2*v])]);
        }

        // Update the color.
        this.call(['UNIFORM', 'myprogram', 'u_color', 'vec3', 
            new Float32Array([u, v, 1.])]);
        
        // Refresh the window.
        this.update();
    });

    c.initialize();
    c.resize();  // resize triggers an paint event.

    // Toggle comments below to have the canvas span the entire window.
    // Also, need to set #mycanvas width and height to 100% in the CSS.
    c.resizable();
    // window.onresize = function(event) {
    //     c.resize();
    // };

    // Toggle fullscreen for the canvas when 'f' is pressed.
    $(window).keypress(function(e) {
        if (String.fromCharCode(e.which) == 'f') {
            c.$el.width("100%").height("100%");
            c.toggle_fullscreen();
        }
    });

});
</script>
<style>
body, #mycanvas {
    /*width: 100%;*/
    /*height: 100%;*/
    width: 800px;
    height: 600px;
    margin: 0;
    padding: 0;
    cursor: default;
}
</style>
</head> 
<body>
<canvas id="mycanvas"></canvas>
</body>
</html>
